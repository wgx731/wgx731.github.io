
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>[NUS Orbital 2014] Mission Control #8 Tutorial Guide - wgx731's Technical Blog</title>
  <meta name="author" content="wgx731">

  
  <meta name="description" content="This post is the guide for you to follow and complete the NUS orbital 2014 mission control #8 tutorial. Wish by after reading the post, you will know &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wgx731.github.io/blog/2014/07/08/nus-orbital-2014-mission-control-number-8-tutorial-guide">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="wgx731's Technical Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32359827-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">wgx731's Technical Blog</a></h1>
  
    <h2>Programmer @ National University Of Singapore.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wgx731.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">[NUS Orbital 2014] Mission Control #8 Tutorial Guide</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-08T09:14:00+08:00" pubdate data-updated="true">Jul 8<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>This post is the guide for you to follow and complete the NUS orbital 2014 mission control #8 tutorial. Wish by after reading the post, you will know testing better and setup your own CI to see all your tests are passing. :P</p>

<!--more-->


<h2>Agenda</h2>

<ul>
<li><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/releases/tag/step-0">Step 0 &ndash; What are we testing</a></li>
<li><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/releases/tag/step-1">Step 1 &ndash; Doctest your model</a></li>
<li><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/releases/tag/step-2">Step 2 &ndash; Unittest your helper method</a></li>
<li><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/releases/tag/step-3">Step 3 &ndash; Test your handler</a></li>
<li><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/releases/tag/step-4">Step 4 &ndash; Use behave to do browser test</a></li>
<li>Final words &ndash; CI</li>
</ul>


<h2>Step by Step Tutorial</h2>

<h5>NOTE: from <code>step-y</code> to <code>step-y-done</code> is one topic of testing, there will be practice and homework for each section. Remember to setup your <code>virtualenv</code> before continue. Below are some tips during the tutorial:</h5>

<ul>
<li>Use below command to go to correct step before reading the related section.</li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git checkout -f step-y
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Use below command to run test with <code>nose</code></li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>nosetests --with-doctest --with-gae --without-sandbox --gae-lib-root<span class="o">=</span><span class="s1">&#39;/path/to/google_appengine/&#39;</span> -v
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Use below command to run test with <code>pytest</code></li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>py.test --doctest-modules --with-gae --gae-path<span class="o">=</span><span class="s1">&#39;/path/to/google_appengine&#39;</span> -v
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Use below command to run test with <code>behave</code></li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>behave -v
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Passing the test doesn&rsquo;t mean that you application doesn&rsquo;t have bugs, and it&rsquo;s not the case that the more test you have the better.</li>
</ul>


<h4>Step 0 (checkout to step-0)</h4>

<p>First of all, I have assumed that you have <a href="http://wgx731.github.io/blog/2014/07/06/orbital-m8-environment-setup/">setup your environment</a> correctly, and you are able to test it out at <code>step-x</code>. This is the easiest step, I have downloaded <a href="https://github.com/GoogleCloudPlatform/appengine-guestbook-python">the sample guestbook application</a>, please go to <code>guestbook</code> folder and try to start the application with your <code>google_appengine</code> and make sure it is running correctly. If you can sign on your guestbook at <a href="http://localhost:8080">http://localhost:8080/</a>, then you are ready to go to the next step.</p>

<p>No practice and homework for this step.</p>

<p><strong><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/compare/step-x...step-0">Code Diff</a></strong></p>

<h4>Step 1 (checkout to <code>step-1</code>)</h4>

<p>The first thing we are going to test is your <code>model</code> for your google app engine project. In <code>guestbook</code>, there is only one <code>model</code> called <code>Greeting</code>. And we will be using python <code>doctest</code> to help us on this task. As a demo, I have already write the testing for creating <code>Greeting</code>. Here is an explanation for the core part of the testing code:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">You</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">Greeting</span><span class="p">:</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">greeting</span> <span class="o">=</span> <span class="n">Greeting</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">guestbook_key</span><span class="p">(),</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;test content&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">greeting</span>
</span><span class='line'><span class="n">Greeting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s">&#39;Guestbook&#39;</span><span class="p">,</span> <span class="s">&#39;default_guestbook&#39;</span><span class="p">,</span> <span class="s">&#39;Greeting&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;test content&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">created_key</span> <span class="o">=</span> <span class="n">greeting</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">You</span> <span class="n">can</span> <span class="n">query</span> <span class="n">to</span> <span class="n">select</span> <span class="n">the</span> <span class="n">greeting</span><span class="p">:</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">greetings_query</span> <span class="o">=</span> <span class="n">Greeting</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ancestor</span><span class="o">=</span><span class="n">guestbook_key</span><span class="p">())</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">greetings_query</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="c"># doctest: +ELLIPSIS</span>
</span><span class='line'><span class="p">[</span><span class="n">Greeting</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s">&#39;Guestbook&#39;</span><span class="p">,</span> <span class="s">&#39;default_guestbook&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this doctest, we have created a new <code>Greeting</code> object and put it into the datastore, and then verify the saving by query <code>Greeting</code> by key.</p>

<p>Now it&rsquo;s your turn to write some test. In the <em>TODO</em> part, I have asked you to write <code>doctest</code> for modification of <code>Greeting</code> object. Please try it out yourself before go to the answers.</p>

<p>Once you have finished writing your <code>doctest</code>, please run the test with either <code>nose</code> or <code>pytest</code> to verify the your answer.</p>

<h6>Homework: Apply doctest to your model in your project where you feel needed.</h6>

<p><strong><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/compare/step-1...step-1-done">Code Diff</a></strong></p>

<h4>Step 2 (checkout to <code>step-2</code>)</h4>

<p>Sometimes, you may have some helper methods in your code, so let&rsquo;s use <code>unittest</code> this time to help us test helper methods. At <code>step-2</code>, I have refactored the code and add a <code>get_user_url</code> helper method. Please study the method and see the test example I have done for you. Here is an explanation for the core part:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="c"># First, create an instance of the Testbed class.</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span> <span class="o">=</span> <span class="n">testbed</span><span class="o">.</span><span class="n">Testbed</span><span class="p">()</span>
</span><span class='line'>    <span class="c"># Then activate the testbed, which prepares the service stubs for use.</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
</span><span class='line'>    <span class="c"># Next, declare which service stubs you want to use.</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">init_user_stub</span><span class="p">()</span>
</span><span class='line'>    <span class="c"># Set up expected values</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">user_login_url</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;https://www.google.com/accounts/Login?continue=http%3A//testbed.example.com/&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;url_linktext&#39;</span><span class="p">:</span> <span class="s">&#39;Login&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">setCurrentUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">is_admin</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
</span><span class='line'>    <span class="n">email_to_set</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>    <span class="n">id_to_set</span> <span class="o">=</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>    <span class="n">admin_to_set</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span> <span class="k">if</span> <span class="n">is_admin</span> <span class="k">else</span> <span class="s">&#39;0&#39;</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">setup_env</span><span class="p">(</span><span class="n">USER_EMAIL</span><span class="o">=</span><span class="n">email_to_set</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">setup_env</span><span class="p">(</span><span class="n">USER_ID</span><span class="o">=</span><span class="n">id_to_set</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">testbed</span><span class="o">.</span><span class="n">setup_env</span><span class="p">(</span><span class="n">USER_IS_ADMIN</span><span class="o">=</span><span class="n">admin_to_set</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">testNoLoginUser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentUser</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">get_user_url</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_login_url</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;url_linktext&#39;</span><span class="p">],</span> <span class="n">is_not</span><span class="p">(</span><span class="s">&#39;Logout&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>setUp</code> method is run before the test to setup the <code>Testbed</code> stub and <code>tearDown</code> method is used to clean up after testing, <code>setCurrentUser</code> is a test helper method and at last <code>testNoLoginUser</code> is the actual test method. By the way, sorry for the java naming convention in python code. I was doing a java project at the same time. :(</p>

<p>Now it&rsquo;s your turn to write some test. In the <em>TODO</em> part, I have asked you to write <code>unittest</code> for testing with a login user. Please try it out yourself before go to the answers.</p>

<p>Once you have finished writing your <code>unittest</code>, please run the test with either <code>nose</code> or <code>pytest</code> to verify the your answer.</p>

<h6>Homework: Apply unittest to your helper method in your project where you feel needed.</h6>

<p><strong><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/compare/step-2...step-2-done">Code Diff</a></strong></p>

<h4>Step 3 (checkout to <code>step-3</code>)</h4>

<p>Now you have finished your unit testing part, you are confident that you code is doing what it is designed to do. But wait, when things integrate together, it may cause other issues. That&rsquo;s why integration testing is needed. In the demo, I have write some code for the integration testing of <code>MainPage</code> handler. Here is the explanation of the core part:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">check_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_body</span><span class="p">):</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">submit_button</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_button</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guest_name_label</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">css_link</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_main_page_no_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">set_current_user</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_int</span><span class="p">,</span> <span class="n">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_ok</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span> <span class="n">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_content_type</span><span class="p">))</span>
</span><span class='line'>    <span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">normal_body</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">check_html</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">login_string</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_main_page_with_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">set_current_user</span><span class="p">(</span><span class="s">&#39;test@test.com&#39;</span><span class="p">,</span> <span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testapp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_int</span><span class="p">,</span> <span class="n">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_ok</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content_type</span><span class="p">,</span> <span class="n">equal_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_content_type</span><span class="p">))</span>
</span><span class='line'>    <span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">normal_body</span>
</span><span class='line'>    <span class="bp">self</span><span class="o">.</span><span class="n">check_html</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logout_string</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The test are quite straight forward, it just route to the correct path for the handler and verify if the html source returned is correct.</p>

<p>Now it&rsquo;s your turn to write some test. In the <em>TODO</em> part, I have asked you to test <code>Guestbook</code> handler. Please try it out yourself before go to the answers.</p>

<p>Once you have finished writing your integration testing for handler, please run the test with either <code>nose</code> or <code>pytest</code> to verify the your answer.</p>

<h6>Homework: Add integration test for handlers in your project.</h6>

<p><strong><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/compare/step-3...step-3-done">Code Diff</a></strong></p>

<h4>Step-4 (checkout to <code>step-4</code>)</h4>

<p>You are almost there. Remember about acceptance testing. Now let&rsquo;s use <code>behave</code> and <code>selenium</code> to help us achieve the goal. Make sure you have a <code>Firefox</code> installed on your machine for the browser testing. You may wonder why we need browser testing as we have finished integration testing. As before, when you product is delivered to users, they will not use it as what you are testing with integration handler test. Browser testing add one more guarantee layer before you product meet the users. In the demo, I have help you to setup the <code>features</code> folder and <code>environment.py</code>, there is also a simple <code>Scenario</code> to test user sign on guestbook without login. Here is the explanation of the core part:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@given</span><span class="p">(</span><span class="s">&#39;user has been sign out&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">step_user_has_sign_out</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
</span><span class='line'>    <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOME</span><span class="p">)</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">sign_out_link</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s">&#39;Logout&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">sign_out_link</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class='line'>    <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
</span><span class='line'>        <span class="k">pass</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@when</span><span class="p">(</span><span class="s">&#39;I go to &quot;{url}&quot;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">step_go_to</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span class='line'>    <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@then</span><span class="p">(</span><span class="s">&#39;I should see main page html&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">step_see_main_page</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
</span><span class='line'>    <span class="n">guest_name_label</span> <span class="o">=</span> <span class="s">&#39;Guestbook name:&#39;</span>
</span><span class='line'>    <span class="n">page_source</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">page_source</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="n">guest_name_label</span><span class="p">))</span>
</span><span class='line'>    <span class="n">elm</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;submit&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">elm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;Sign Guestbook&quot;</span>
</span><span class='line'>    <span class="n">elm</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;switch&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">elm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;switch&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@when</span><span class="p">(</span><span class="s">&#39;I sign &quot;{content}&quot;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">setp_sign_content</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span><span class='line'>    <span class="n">elm</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">elm</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span class='line'>    <span class="n">button</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">&quot;submit&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@then</span><span class="p">(</span><span class="s">&#39;I should see &quot;{content}&quot; signed by &quot;{user}&quot;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">setp_see_content</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
</span><span class='line'>    <span class="n">page_source</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">page_source</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">page_source</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="s">&quot;&lt;blockquote&gt;</span><span class="si">%s</span><span class="s">&lt;/blockquote&gt;&quot;</span> <span class="o">%</span> <span class="n">content</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_that</span><span class="p">(</span><span class="n">page_source</span><span class="p">,</span> <span class="n">contains_string</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the magic from <code>behave</code>, by using <code>@given</code>, <code>@when</code>, <code>@then</code> decorators, we are able to translate our <code>feature</code> document into real test code. Take a note with how <code>{}</code> is used for gather information from the <code>feature</code> document.</p>

<p>Now it&rsquo;s your turn to write some test. In the <em>TODO</em> part, I have asked you to test user sign on guestbook with login. Please try it out yourself before go to the answers.</p>

<p>Once you have finished writing your integration testing for handler, please run the test with <code>behave</code> to verify the your answer.</p>

<h6>Homework: Try to add browser testing in your project if you are interested, as it is a bit hard to setup the environment compared to previous unit testing and integration testing.</h6>

<p><strong><a href="https://github.com/wgx731/2014-nus-orbital-mission-control-8/compare/step-4...step-4-done">Code Diff</a></strong></p>

<h4>Final words &ndash; CI</h4>

<p>Now you have tested your project. Do you want to know how well your test is? Do you want to have a CI server to show off? :D</p>

<p>You can check out <a href="https://travis-ci.org/wgx731/2014-nus-orbital-mission-control-8">Travis CI</a> or <a href="https://drone.io/wgx731/2014-nus-orbital-mission-control-8-google-code">Drone CI</a> for this project.</p>

<p>To setup CI server for you project, you can refer to the documentation from <a href="http://docs.travis-ci.com/">Travis</a> and <a href="http://docs.drone.io/">Drone</a> for more details.</p>

<p>And you can also setup <a href="https://coveralls.io/">coveralls report</a> if you want. :)</p>

<p>That&rsquo;s all I have to share with you about python testing, wish you all are enjoying it.</p>

<h5>Please comment or send email to me if you have any trouble or if you feel there is any error in the tutorial guide.</h5>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">wgx731</span></span>

      








  


<time datetime="2014-07-08T09:14:00+08:00" pubdate data-updated="true">Jul 8<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/gae/'>GAE</a>, <a class='category' href='/blog/categories/nus/'>NUS</a>, <a class='category' href='/blog/categories/mission-control/'>mission-control</a>, <a class='category' href='/blog/categories/orbital/'>orbital</a>, <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/testing/'>testing</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/07/06/orbital-m8-environment-setup/" title="Previous Post: [NUS Orbital 2014] Mission Control #8 Environment Setup Guide">&laquo; [NUS Orbital 2014] Mission Control #8 Environment Setup Guide</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/07/15/more-experience-from-play/" title="Next Post: More experience from Play!">More experience from Play! &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
    <h1>Categories</h1>
    <ul id="categories">
        <li>
            <a class='category' href='/blog/categories/cs3216/'>CS3216</a>, <a class='category' href='/blog/categories/facebook/'>Facebook</a>, <a class='category' href='/blog/categories/gae/'>GAE</a>, <a class='category' href='/blog/categories/nus/'>NUS</a>, <a class='category' href='/blog/categories/play/'>Play!</a>, <a class='category' href='/blog/categories/deployment/'>deployment</a>, <a class='category' href='/blog/categories/django/'>django</a>, <a class='category' href='/blog/categories/git/'>git</a>, <a class='category' href='/blog/categories/jackson/'>jackson</a>, <a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/mission-control/'>mission-control</a>, <a class='category' href='/blog/categories/orbital/'>orbital</a>, <a class='category' href='/blog/categories/python/'>python</a>, <a class='category' href='/blog/categories/sbt/'>sbt</a>, <a class='category' href='/blog/categories/sbt-jacoco/'>sbt-jacoco</a>, <a class='category' href='/blog/categories/shell/'>shell</a>, <a class='category' href='/blog/categories/testing/'>testing</a>
        </li>
    </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/15/more-experience-from-play/">More Experience From Play!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/08/nus-orbital-2014-mission-control-number-8-tutorial-guide/">[NUS Orbital 2014] Mission Control #8 Tutorial Guide</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/06/orbital-m8-environment-setup/">[NUS Orbital 2014] Mission Control #8 Environment Setup Guide</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/24/jackson-and-export-problem/">Jackson &amp; Export Problem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/01/team-dynamics-reflection/">Team Dynamics Reflection</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/wgx731">@wgx731</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'wgx731',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/108755701601057899826?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - wgx731 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wgx731-tech-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://wgx731.github.io/blog/2014/07/08/nus-orbital-2014-mission-control-number-8-tutorial-guide/';
        var disqus_url = 'http://wgx731.github.io/blog/2014/07/08/nus-orbital-2014-mission-control-number-8-tutorial-guide/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
